# デザインシステム構築方法論

Material Designの原理原則に基づき、プロジェクト固有のデザインシステムを設計・構築するための方法論。

## Table of Contents

1. [デザインシステムのレイヤー構造](#デザインシステムのレイヤー構造)
2. [トークンアーキテクチャ設計](#トークンアーキテクチャ設計)
3. [コンポーネント設計原則](#コンポーネント設計原則)
4. [パターン体系化](#パターン体系化)
5. [ガバナンスと進化](#ガバナンスと進化)

---

## デザインシステムのレイヤー構造

デザインシステムは4つのレイヤーで構成される。下層ほど安定し、上層ほどプロジェクト固有の表現が強くなる。

### Layer 1: 原理原則（Principles）

変わらない設計哲学。プロジェクトを超えて適用される。

- 視覚的階層: サイズ・色・余白で情報の優先度を表現する
- アフォーダンス: 操作可能な要素はそれと分かる見た目にする
- フィードバック: ユーザーの操作に対して即座に応答する
- 一貫性: 同じ意味には同じ表現を使う
- アクセシビリティ: 多様な能力を持つユーザーが利用できる

### Layer 2: デザイントークン（Tokens）

原則をプロジェクト固有の値に変換する。色・形・間隔・動きの数値体系。

- ブランドカラーからカラースキームを導出する
- タイポグラフィスケールを定義する
- シェイプ（角丸）スケールを定義する
- スペーシングスケールを定義する
- モーション（イージング・デュレーション）を定義する

### Layer 3: コンポーネントパターン（Patterns）

トークンを用いて構築する再利用可能なUIパターン。Materialの既定コンポーネントに縛られず、プロジェクトの要求に応じて設計する。

- 操作パターン: ボタン、トグル、入力
- 情報表示パターン: カード、リスト、ステータス表示
- ナビゲーションパターン: 画面遷移、タブ、階層移動
- フィードバックパターン: 通知、確認、進捗

### Layer 4: 画面構成（Compositions）

パターンを組み合わせた具体的な画面レイアウト。プロジェクトのユースケースに直結する。

---

## トークンアーキテクチャ設計

### トークンの3階層

```
Reference Tokens → System Tokens → Component Tokens
（生の値）       （意味を持つ値）  （用途に紐づく値）
```

#### Reference Tokens

色のパレットやフォントサイズなど、意味を持たない生の値。

```
blue-500: #2196F3
gray-100: #F5F5F5
font-size-16: 16px
radius-12: 12px
```

#### System Tokens

プロジェクトの意味体系に沿った名前を付ける。Reference Tokensを参照する。

```
color-primary: {blue-500}
color-surface: {gray-100}
text-body: {font-size-16}
shape-medium: {radius-12}
```

#### Component Tokens

特定のUIパターンに紐づく値。System Tokensを参照する。

```
button-bg: {color-primary}
button-radius: {shape-medium}
card-bg: {color-surface}
card-radius: {shape-medium}
```

### カラートークン設計手順

1. ブランドカラーをソースカラーとして設定する
2. ソースカラーからトーナルパレット（明度の段階）を生成する
3. 役割（primary, secondary, tertiary, surface, error）にトーンを割り当てる
4. ライトテーマとダークテーマの両方を定義する
5. セマンティックカラー（成功、警告、情報）を追加する

### タイポグラフィトークン設計手順

1. プロジェクトのブランドフォントを選定する
2. 用途ロール（display, headline, title, body, label）を定義する
3. 各ロールのサイズ・ウェイト・行間・字間を設定する
4. レスポンシブスケーリングのルールを定める

### シェイプトークン設計手順

1. ブランドの性格に合うシェイプスケールを定義する（角丸の段階）
2. 要素のサイズと重要度にシェイプを割り当てるルールを決める
3. シェイプの意味を明確にする（角丸が大きいほどフレンドリー、など）

### スペーシングトークン設計手順

1. ベースユニットを決める（4dp推奨）
2. スケールを定義する（4, 8, 12, 16, 24, 32, 48, 64...）
3. 用途別の命名規則を設ける（inset, stack, inline, section）

### モーショントークン設計手順

1. デュレーションスケールを定義する（short, medium, long）
2. イージングカーブを選定する（emphasized, standard）
3. プロジェクトの性格に合わせてカスタマイズする
4. `prefers-reduced-motion`対応のフォールバックを定義する

---

## コンポーネント設計原則

Materialの既定コンポーネントをそのまま使うのではなく、以下の原則に従ってプロジェクト固有のコンポーネントを設計する。

### 原則1: 役割ベースの設計

コンポーネントは見た目ではなく役割で定義する。

**問い**
- このコンポーネントはどんなユーザー行動を支援するか
- 画面上でどの程度の注意を引くべきか（強調度）
- 他のコンポーネントとどのような関係にあるか

**強調度の体系**

コンポーネントの強調度を3段階で整理する。

| 強調度 | 視覚的特徴 | 使用場面 |
|--------|-----------|---------|
| High | 塗りつぶし、高コントラスト | 画面の主要アクション |
| Medium | 線、中間色 | 補助的なアクション |
| Low | テキストのみ、低コントラスト | 三次的なアクション |

### 原則2: 状態の明示

すべてのインタラクティブ要素に状態体系を定義する。

**必須状態**
- Default: 通常の状態
- Hover: ポインタが乗った状態（デスクトップ）
- Focused: キーボードフォーカス
- Pressed: 押下中
- Disabled: 無効

**状態レイヤーの実装**

半透明オーバーレイで状態を表現する。これにより任意の背景色のコンポーネントに統一的な状態表現を適用できる。

```
Hover: 主色 8% opacity
Focus: 主色 12% opacity
Press: 主色 12% opacity
Drag: 主色 16% opacity
```

### 原則3: コンテナ思考

コンポーネントを独立したコンテナとして設計する。

**コンテナの構成要素**
- 背景（Surface）: 色、エレベーション
- 境界（Boundary）: 線、角丸
- 内部余白（Padding）: スペーシングトークンを使用
- コンテンツスロット: 可変なコンテンツ領域

**エレベーションの使い分け**
- 重なり順を表現する
- 注意の優先度を示す
- 影とサーフェスティントの2手法を使い分ける

### 原則4: レスポンシブ適応

ウィンドウサイズに応じてコンポーネントの振る舞いを変える。

**適応のレベル**
- リフロー: 要素の配置変更（横並び→縦並び）
- リサイズ: 要素のサイズ変更
- 表示/非表示: 要素の出し入れ
- 変換: 別のパターンへの切り替え（ボトムナビ→サイドナビ）

### 原則5: アクセシビリティファースト

コンポーネント設計の初期段階からアクセシビリティを組み込む。

- 最小タッチターゲット: 48×48dp
- カラーコントラスト: WCAG 2.1 Level AA以上
- キーボード操作: すべてのインタラクションがキーボードで完結する
- スクリーンリーダー: 適切なセマンティクスとラベル
- テキストリサイズ: 200%まで対応

---

## パターン体系化

### パターンカタログの構築方法

プロジェクトのUIを分析し、繰り返し現れるパターンを抽出・体系化する。

#### Step 1: UIインベントリ

既存の画面・プロトタイプからすべてのUI要素を収集する。

- スクリーンショットの収集
- 要素の分類（操作、表示、ナビゲーション、フィードバック）
- 重複と不整合の特定

#### Step 2: パターン抽出

類似する要素をグルーピングし、パターンとして抽象化する。

- 同じ役割を持つ要素を統合する
- バリエーション（サイズ、強調度）を整理する
- 命名規則を統一する

#### Step 3: パターン定義

各パターンに以下を定義する。

- 目的: 何のために存在するか
- 構造: どのような要素で構成されるか
- トークンマッピング: どのデザイントークンを使うか
- バリエーション: どのようなバリエーションがあるか
- 使用ガイドライン: どの場面で使い、どの場面で使わないか

#### Step 4: パターン間の関係定義

パターン同士の関係を整理する。

- 代替関係: 同じ目的の別パターン（使い分け基準を明記）
- 構成関係: あるパターンが別のパターンを含む
- 排他関係: 同時に使うべきでないパターン

### ナビゲーション体系の設計

画面サイズとコンテンツ構造に応じてナビゲーションパターンを選定する。

**設計の問い**
- アプリのトップレベルの目的地はいくつあるか
- 階層の深さはどの程度か
- ユーザーはどのデバイスを主に使うか
- コンテンツの構造は平坦か階層的か

**ウィンドウサイズ別の検討**

| サイズ | 検討すべきパターン |
|--------|------------------|
| Compact (<600dp) | 画面下部ナビゲーション、タブ |
| Medium (600-840dp) | サイドレール、折りたたみパネル |
| Expanded (>840dp) | サイドドロワー、マルチペイン |

### レイアウト体系の設計

**カノニカルレイアウト**

よく使われるレイアウトパターンを定義し、プロジェクト全体で統一する。

- 一覧→詳細: マスターリストと詳細ペインの構成
- フィード: スクロール可能なコンテンツストリーム
- 補助パネル: メインコンテンツ+補足情報

**グリッドシステム**
- カラム数をウィンドウサイズごとに定義する
- ガター幅を統一する
- マージン規則を設ける

---

## ガバナンスと進化

### デザインシステムの運用

#### 変更管理

- トークンの変更は全プロダクトに波及するため、慎重に行う
- セマンティックバージョニングでトークンとパターンを管理する
- 破壊的変更にはマイグレーションガイドを用意する

#### 品質基準

新しいパターンをシステムに追加する際の基準を設ける。

- 3つ以上の画面で使用される（再利用性）
- トークンのみで構成される（一貫性）
- アクセシビリティ要件を満たす
- レスポンシブ対応が完了している

#### 監査プロセス

定期的にプロダクトとデザインシステムの整合性を確認する。

- プロダクトのUIがトークンとパターンに準拠しているか
- 未定義のスタイルやパターンが増えていないか
- 不要になったパターンがないか

### デザインシステムの拡張

#### 新パターン追加のフロー

1. プロダクト要求から必要性を確認する
2. 既存パターンで代替できないか検討する
3. 原則に基づいて設計する（役割、状態、コンテナ、レスポンシブ、アクセシビリティ）
4. トークンマッピングを定義する
5. ドキュメントと使用ガイドラインを作成する
6. レビューと承認を経て追加する

#### トークン拡張のフロー

1. 既存トークンで表現できない値が3回以上現れたら検討する
2. System Tokenとして追加するか、Component Tokenとして局所化するか判断する
3. 命名規則に従って追加する
4. 既存のComponent Tokensへの影響を確認する

---

## References

- Material Design Foundations: https://m3.material.io/foundations/
- Design Tokens: https://m3.material.io/foundations/design-tokens/overview
- Layout: https://m3.material.io/foundations/layout/understanding-layout/overview
